import numpy as np
import pickle
from sklearn.feature_extraction.text import CountVectorizer
from sklearn.metrics.pairwise import pairwise_distances


class news_searcher:
    def __init__(self, path):
        '''
        content-based CF를 이용해 적합한 뉴스 기사를 찾아준다. 추천으로 활용 가능.
        :param path: document_list(각 document의 tf_vector를 원소로 갖는 list)을 저장할 path (string) 
        '''
        self.path = path
        self.dtm_index = []
        self.dtm_list = []
        self.dtm = None
        self.jaccard_matrix = None
        self.vctr = CountVectorizer()
        try: #파일이 존재하는 경우
            with open(self.path, mode="rb") as fp:
                self.dtm_index, self.dtm_list = pickle.load(fp)

            if len(self.dtm_index) == 0: #파일이 존재하지만 저장된 정보가 없을 경우
                print("Empty Document_Term_Matrix has been loaded.")
            else: #정보가 이미 저장된 파일이 존재하는 경우
                self.create_jaccard_matrix()
                print("Document_Term_Matrix has been loaded successfully.")

        except: #파일이 없는 경우 메세지를 띄우고 새로 빈 파일을 생성한다.
            print("There are no existing Document_Term_Matrix.")
            with open(self.path, mode="wb") as fp:
                pickle.dump([self.dtm_index, self.dtm_list], fp)
            print("New Document_Term_Matrix has been created.")


    def get_document_tfvector(self, document_id):
        '''
        document_id를 받아서 해당 document의 tf-idf vector를 가져오는 함수
        :param document_id: 뉴스의 document_id (string)
        :return: 해당 document의 tf-idf vector (dictionary)
        '''
        # temp = {'기본': 0.07202824060656197, '독자': 0.03601412030328099, '스스로': 0.03601412030328099, '엇갈려': 0.03601412030328099, '라고': 0.03601412030328099, '청와대': 0.18007060151640494, '구조': 0.2160847218196859, '문재인': 0.07202824060656197, '위한': 0.03601412030328099, '공개': 0.03601412030328099, '다른': 0.03601412030328099, '바른': 0.03601412030328099, '전재': 0.03601412030328099, '절대': 0.03601412030328099, '같이': 0.03601412030328099, '지시': 0.03601412030328099, '장관': 0.03601412030328099, '관계자': 0.03601412030328099, '단독': 0.03601412030328099, '헤리티지': 0.03601412030328099, '합의': 0.03601412030328099, '미루': 0.03601412030328099, '덕분': 0.03601412030328099, '분산': 0.03601412030328099, '당은': 0.03601412030328099, '김성태': 0.03601412030328099, '대통령': 0.5402118045492148, '반드시': 0.03601412030328099, '무단': 0.03601412030328099, '이날': 0.03601412030328099, '구상': 0.03601412030328099, '직접': 0.03601412030328099, '언론': 0.03601412030328099, '입장': 0.03601412030328099, '위원장': 0.03601412030328099, '오신환': 0.03601412030328099, '동떨어진': 0.03601412030328099, '지방': 0.03601412030328099, '원칙': 0.03601412030328099, '관측': 0.03601412030328099, '지역': 0.03601412030328099, '분권': 0.14405648121312395, '회견': 0.03601412030328099, '회동': 0.03601412030328099, '선거': 0.03601412030328099, '우열': 0.03601412030328099, '제도': 0.03601412030328099, '국회': 0.03601412030328099, '측면': 0.03601412030328099, '해소': 0.03601412030328099, '만큼': 0.03601412030328099, '신년': 0.03601412030328099, '방안': 0.03601412030328099, '기자': 0.07202824060656197, '접점': 0.03601412030328099, '페이스북': 0.03601412030328099, '굳이': 0.03601412030328099, '너무나': 0.03601412030328099, '가장': 0.03601412030328099, '수준': 0.03601412030328099, '일단': 0.03601412030328099, '지적': 0.03601412030328099, '금지': 0.03601412030328099, '해결': 0.03601412030328099, '선거구': 0.10804236090984295, '비례': 0.03601412030328099, '따라': 0.03601412030328099, '저지': 0.03601412030328099, '국민': 0.14405648121312395, '얘기': 0.03601412030328099, '문제점': 0.03601412030328099, '주도': 0.10804236090984295, '지난해': 0.07202824060656197, '자치': 0.03601412030328099, '하지만': 0.07202824060656197, '원내대표': 0.14405648121312395, '정당': 0.03601412030328099, '유지': 0.14405648121312395, '자유': 0.03601412030328099, '정치': 0.07202824060656197, '한다는': 0.03601412030328099, '야당': 0.03601412030328099, '김동철': 0.03601412030328099, '개편': 0.07202824060656197, '윤곽': 0.03601412030328099, '동아일보': 0.14405648121312395, '생각': 0.18007060151640494, '분명히': 0.03601412030328099, '제외': 0.03601412030328099, '과정': 0.03601412030328099, '어려운': 0.03601412030328099, '총의': 0.03601412030328099, '인터뷰': 0.03601412030328099, '언급': 0.03601412030328099, '한다': 0.03601412030328099, '정해구': 0.03601412030328099, '나온다': 0.03601412030328099, '정부': 0.03601412030328099, '빠질': 0.03601412030328099, '편안': 0.07202824060656197, '논의': 0.03601412030328099, '된다면': 0.03601412030328099, '나중': 0.03601412030328099, '여지': 0.07202824060656197, '문제': 0.07202824060656197, '여러분': 0.03601412030328099, '개헌안': 0.2160847218196859, '선택': 0.03601412030328099, '높일': 0.03601412030328099, '남겨': 0.03601412030328099, '그대로': 0.03601412030328099, '마련': 0.07202824060656197, '지난달': 0.03601412030328099, '국당': 0.03601412030328099, '권력': 0.2881129624262479, '포함': 0.03601412030328099, '둔다': 0.03601412030328099, '소신': 0.03601412030328099, '주장': 0.07202824060656197, '핵심': 0.03601412030328099, '타파': 0.03601412030328099, '임기': 0.03601412030328099, '구도': 0.03601412030328099, '동아': 0.03601412030328099, '여야': 0.03601412030328099, '집중': 0.07202824060656197, '입니다': 0.03601412030328099, '공식': 0.03601412030328099, '모으': 0.03601412030328099, '만약': 0.03601412030328099, '대한': 0.07202824060656197, '제왕': 0.18007060151640494, '따지': 0.03601412030328099, '댄다는': 0.03601412030328099, '앞서': 0.03601412030328099, '종식': 0.07202824060656197, '나섰': 0.03601412030328099, '한국': 0.03601412030328099, '협상': 0.07202824060656197, '다수': 0.03601412030328099, '문재': 0.03601412030328099, '정책': 0.03601412030328099, '개헌': 0.2520988421229669, '배포': 0.03601412030328099, '기획': 0.03601412030328099, '관심': 0.10804236090984295, '형태': 0.03601412030328099}
        # temp는 위와 같은 꼴의 정보이다.
        # return temp

        #아래는 테스트용으로 임시로 만든 코드
        doc1 = {'기본': 0.07202824060656197, '독자': 0.03601412030328099, '스스로': 0.03601412030328099,
                '엇갈려': 0.03601412030328099, '라고': 0.03601412030328099, '청와대': 0.18007060151640494,
                '구조': 0.2160847218196859, '문재인': 0.07202824060656197, '위한': 0.03601412030328099,
                '공개': 0.03601412030328099, '다른': 0.03601412030328099, '바른': 0.03601412030328099,
                '전재': 0.03601412030328099, '절대': 0.03601412030328099, '같이': 0.03601412030328099,
                '지시': 0.03601412030328099, '장관': 0.03601412030328099, '관계자': 0.03601412030328099,
                '단독': 0.03601412030328099, '헤리티지': 0.03601412030328099, '합의': 0.03601412030328099,
                '미루': 0.03601412030328099, '덕분': 0.03601412030328099, '분산': 0.03601412030328099,
                '당은': 0.03601412030328099, '김성태': 0.03601412030328099, '대통령': 0.5402118045492148,
                '반드시': 0.03601412030328099, '무단': 0.03601412030328099, '이날': 0.03601412030328099,
                '구상': 0.03601412030328099, '직접': 0.03601412030328099, '언론': 0.03601412030328099,
                '입장': 0.03601412030328099, '위원장': 0.03601412030328099, '오신환': 0.03601412030328099,
                '동떨어진': 0.03601412030328099, '지방': 0.03601412030328099, '원칙': 0.03601412030328099,
                '관측': 0.03601412030328099, '지역': 0.03601412030328099, '분권': 0.14405648121312395,
                '회견': 0.03601412030328099, '회동': 0.03601412030328099, '선거': 0.03601412030328099,
                '우열': 0.03601412030328099, '제도': 0.03601412030328099, '국회': 0.03601412030328099,
                '측면': 0.03601412030328099, '해소': 0.03601412030328099, '만큼': 0.03601412030328099,
                '신년': 0.03601412030328099, '방안': 0.03601412030328099, '기자': 0.07202824060656197,
                '접점': 0.03601412030328099, '페이스북': 0.03601412030328099, '굳이': 0.03601412030328099,
                '너무나': 0.03601412030328099, '가장': 0.03601412030328099, '수준': 0.03601412030328099,
                '일단': 0.03601412030328099, '지적': 0.03601412030328099, '금지': 0.03601412030328099,
                '해결': 0.03601412030328099, '선거구': 0.10804236090984295, '비례': 0.03601412030328099,
                '따라': 0.03601412030328099, '저지': 0.03601412030328099, '국민': 0.14405648121312395,
                '얘기': 0.03601412030328099, '문제점': 0.03601412030328099, '주도': 0.10804236090984295,
                '지난해': 0.07202824060656197, '자치': 0.03601412030328099, '하지만': 0.07202824060656197,
                '원내대표': 0.14405648121312395, '정당': 0.03601412030328099, '유지': 0.14405648121312395,
                '자유': 0.03601412030328099, '정치': 0.07202824060656197, '한다는': 0.03601412030328099,
                '야당': 0.03601412030328099, '김동철': 0.03601412030328099, '개편': 0.07202824060656197,
                '윤곽': 0.03601412030328099, '동아일보': 0.14405648121312395, '생각': 0.18007060151640494,
                '분명히': 0.03601412030328099, '제외': 0.03601412030328099, '과정': 0.03601412030328099,
                '어려운': 0.03601412030328099, '총의': 0.03601412030328099, '인터뷰': 0.03601412030328099,
                '언급': 0.03601412030328099, '한다': 0.03601412030328099, '정해구': 0.03601412030328099,
                '나온다': 0.03601412030328099, '정부': 0.03601412030328099, '빠질': 0.03601412030328099,
                '편안': 0.07202824060656197, '논의': 0.03601412030328099, '된다면': 0.03601412030328099,
                '나중': 0.03601412030328099, '여지': 0.07202824060656197, '문제': 0.07202824060656197,
                '여러분': 0.03601412030328099, '개헌안': 0.2160847218196859, '선택': 0.03601412030328099,
                '높일': 0.03601412030328099, '남겨': 0.03601412030328099, '그대로': 0.03601412030328099,
                '마련': 0.07202824060656197, '지난달': 0.03601412030328099, '국당': 0.03601412030328099,
                '권력': 0.2881129624262479, '포함': 0.03601412030328099, '둔다': 0.03601412030328099,
                '소신': 0.03601412030328099, '주장': 0.07202824060656197, '핵심': 0.03601412030328099,
                '타파': 0.03601412030328099, '임기': 0.03601412030328099, '구도': 0.03601412030328099,
                '동아': 0.03601412030328099, '여야': 0.03601412030328099, '집중': 0.07202824060656197,
                '입니다': 0.03601412030328099, '공식': 0.03601412030328099, '모으': 0.03601412030328099,
                '만약': 0.03601412030328099, '대한': 0.07202824060656197, '제왕': 0.18007060151640494,
                '따지': 0.03601412030328099, '댄다는': 0.03601412030328099, '앞서': 0.03601412030328099,
                '종식': 0.07202824060656197, '나섰': 0.03601412030328099, '한국': 0.03601412030328099,
                '협상': 0.07202824060656197, '다수': 0.03601412030328099, '문재': 0.03601412030328099,
                '정책': 0.03601412030328099, '개헌': 0.2520988421229669, '배포': 0.03601412030328099,
                '기획': 0.03601412030328099, '관심': 0.10804236090984295, '형태': 0.03601412030328099}
        doc2 = {'재계': 0.026880166528523517, '계열사': 0.026880166528523517, '삼성그룹': 0.026880166528523517,
                '철학': 0.026880166528523517, '함께': 0.026880166528523517, '입증': 0.026880166528523517,
                '전면': 0.026880166528523517, '후계자': 0.026880166528523517, '다만': 0.026880166528523517,
                '바로': 0.026880166528523517, '멈춰': 0.026880166528523517, '전재': 0.026880166528523517,
                '부회장': 0.40320249792785273, '실적': 0.08064049958557055, '내릴': 0.026880166528523517,
                '인기': 0.026880166528523517, '나오': 0.053760333057047034, '출석': 0.026880166528523517,
                '유착': 0.026880166528523517, '자동차': 0.026880166528523517, '처음': 0.026880166528523517,
                '경향': 0.053760333057047034, '만큼': 0.08064049958557055, '이후': 0.10752066611409407,
                '사물': 0.026880166528523517, '우선': 0.053760333057047034, '내년': 0.026880166528523517,
                '다음': 0.026880166528523517, '이건희': 0.053760333057047034, '전문': 0.026880166528523517,
                '만들': 0.026880166528523517, '승계': 0.053760333057047034, '움직임': 0.026880166528523517,
                '국민': 0.053760333057047034, '선임': 0.026880166528523517, '상황': 0.026880166528523517,
                '고도': 0.026880166528523517, '자율': 0.026880166528523517, '전망': 0.08064049958557055,
                '결정': 0.08064049958557055, '계기': 0.053760333057047034, '사회': 0.08064049958557055,
                '나서': 0.026880166528523517, '판결': 0.026880166528523517, '풀려난': 0.026880166528523517,
                '된다': 0.026880166528523517, '삼성전자': 0.3225619983422822, '고민': 0.026880166528523517,
                '거론': 0.026880166528523517, '부재': 0.026880166528523517, '무료': 0.026880166528523517,
                '벗어나': 0.026880166528523517, '등기': 0.026880166528523517, '게이트': 0.053760333057047034,
                '이사': 0.026880166528523517, '사태': 0.026880166528523517, '정보': 0.026880166528523517,
                '과거': 0.026880166528523517, '금지': 0.026880166528523517, '선고': 0.026880166528523517,
                '결심': 0.026880166528523517, '최지성': 0.026880166528523517, '대부분': 0.026880166528523517,
                '승마': 0.026880166528523517, '최순': 0.08064049958557055, '빠르': 0.026880166528523517,
                '청사진': 0.026880166528523517, '대한': 0.08064049958557055, '방안': 0.053760333057047034,
                '사상': 0.053760333057047034, '만화': 0.026880166528523517, '총수': 0.026880166528523517,
                '기회': 0.026880166528523517, '지난해': 0.18816116569966462, '변화': 0.026880166528523517,
                '메모리': 0.026880166528523517, '생각': 0.026880166528523517, '수차례': 0.026880166528523517,
                '특히': 0.053760333057047034, '혐의': 0.026880166528523517, '비즈': 0.053760333057047034,
                '인공지능': 0.026880166528523517, '보여': 0.08064049958557055, '주장': 0.026880166528523517,
                '다가온': 0.026880166528523517, '지원': 0.026880166528523517, '투자': 0.08064049958557055,
                '제기': 0.026880166528523517, '힘입': 0.026880166528523517, '회사기': 0.026880166528523517,
                '버린': 0.026880166528523517, '사항': 0.026880166528523517, '국회': 0.026880166528523517,
                '창업': 0.08064049958557055, '역할': 0.026880166528523517, '대체': 0.026880166528523517,
                '수감': 0.10752066611409407, '김창길': 0.026880166528523517, '선제': 0.026880166528523517,
                '창출': 0.026880166528523517, '강화': 0.053760333057047034, '사흘': 0.026880166528523517,
                '규모': 0.10752066611409407, '재판': 0.053760333057047034, '협력': 0.026880166528523517,
                '종합': 0.026880166528523517, '업무': 0.053760333057047034, '기자': 0.053760333057047034,
                '지속': 0.026880166528523517, '영어': 0.026880166528523517, '위한': 0.026880166528523517,
                '호황': 0.08064049958557055, '페이스북': 0.026880166528523517, '회복': 0.10752066611409407,
                '계획': 0.053760333057047034, '추가': 0.026880166528523517, '책임': 0.026880166528523517,
                '사이클': 0.026880166528523517, '상생': 0.026880166528523517, '집중': 0.026880166528523517,
                '정도': 0.026880166528523517, '검찰': 0.026880166528523517, '바람': 0.026880166528523517,
                '이재용': 0.1344008326426176, '체제': 0.08064049958557055, '일자리': 0.026880166528523517,
                '과제': 0.026880166528523517, '부분': 0.026880166528523517, '업계': 0.026880166528523517,
                '여론': 0.026880166528523517, '관측': 0.08064049958557055, '조사': 0.026880166528523517,
                '기울일': 0.026880166528523517, '위원회': 0.026880166528523517, '이내': 0.026880166528523517,
                '대비': 0.026880166528523517, '항상': 0.026880166528523517, '소속': 0.026880166528523517,
                '장비': 0.026880166528523517, '주력': 0.053760333057047034, '동반': 0.026880166528523517,
                '삼성': 0.053760333057047034, '위원': 0.026880166528523517, '기술': 0.053760333057047034,
                '예측': 0.026880166528523517, '새로운': 0.026880166528523517, '사실': 0.08064049958557055,
                '공판': 0.026880166528523517, '자신': 0.08064049958557055, '기록': 0.026880166528523517,
                '일선': 0.026880166528523517, '결국': 0.026880166528523517, '복귀': 0.10752066611409407,
                '전자': 0.10752066611409407, '빅딜': 0.026880166528523517, '타이틀': 0.026880166528523517,
                '어떻게': 0.026880166528523517, '예상': 0.08064049958557055, '장기': 0.026880166528523517,
                '전장': 0.026880166528523517, '업체': 0.026880166528523517, '정유라': 0.026880166528523517,
                '유지': 0.026880166528523517, '주행': 0.026880166528523517, '경영': 0.3494421648708057,
                '못했': 0.026880166528523517, '비상': 0.026880166528523517, '어느': 0.026880166528523517,
                '개회식': 0.053760333057047034, '문재인': 0.026880166528523517, '유치': 0.026880166528523517,
                '전략': 0.053760333057047034, '현재': 0.026880166528523517, '명예': 0.026880166528523517,
                '나온다': 0.026880166528523517, '구심점': 0.026880166528523517, '들여': 0.026880166528523517,
                '서초구': 0.026880166528523517, '본격': 0.053760333057047034, '진술': 0.026880166528523517,
                '신뢰': 0.1344008326426176, '이번': 0.08064049958557055, '중점': 0.026880166528523517,
                '놓친': 0.026880166528523517, '최대': 0.053760333057047034, '가량': 0.053760333057047034,
                '마음': 0.026880166528523517, '연루': 0.053760333057047034, '먹거리': 0.053760333057047034,
                '증언': 0.026880166528523517, '발전': 0.026880166528523517, '합병': 0.10752066611409407,
                '공격': 0.026880166528523517, '이윤주': 0.026880166528523517, '정경': 0.026880166528523517,
                '무죄': 0.026880166528523517, '떨어져': 0.026880166528523517, '동계': 0.026880166528523517,
                '이미지': 0.053760333057047034, '위해': 0.026880166528523517, '바닥': 0.026880166528523517,
                '발굴': 0.026880166528523517, '하만': 0.053760333057047034, '발언': 0.026880166528523517,
                '라고': 0.026880166528523517, '구체': 0.026880166528523517, '사옥': 0.026880166528523517,
                '밝혀왔': 0.026880166528523517, '최후': 0.026880166528523517, '그룹': 0.1344008326426176,
                '능력': 0.026880166528523517, '올림픽': 0.08064049958557055, '반도체': 0.10752066611409407,
                '청문회': 0.026880166528523517, '어려울': 0.026880166528523517, '되돌아보': 0.026880166528523517,
                '어렵': 0.053760333057047034, '국제': 0.026880166528523517, '나부끼': 0.026880166528523517,
                '나설': 0.026880166528523517, '탄력': 0.026880166528523517, '석방': 0.026880166528523517,
                '일각': 0.026880166528523517, '되찾': 0.026880166528523517, '둔화': 0.026880166528523517,
                '기념식': 0.026880166528523517, '서울': 0.026880166528523517, '회장': 0.1344008326426176,
                '글로벌': 0.026880166528523517, '보인다': 0.10752066611409407, '무리': 0.026880166528523517,
                '지적': 0.026880166528523517, '총력': 0.053760333057047034, '인터넷': 0.026880166528523517,
                '정부': 0.026880166528523517, '내놓': 0.026880166528523517, '확정': 0.026880166528523517,
                '배포': 0.026880166528523517, '평창': 0.053760333057047034, '집행유예': 0.026880166528523517,
                '안팎': 0.026880166528523517, '선언': 0.053760333057047034, '스타일': 0.026880166528523517,
                '무단': 0.026880166528523517, '기인': 0.026880166528523517, '인수': 0.1344008326426176,
                '경향신문': 0.026880166528523517, '미래': 0.08064049958557055, '실장': 0.026880166528523517,
                '박근혜': 0.053760333057047034, '기업': 0.08064049958557055, '실추': 0.026880166528523517,
                '가져올': 0.026880166528523517, '부패': 0.026880166528523517, '부정': 0.026880166528523517,
                '슈퍼': 0.053760333057047034, '가능': 0.053760333057047034, '여전히': 0.026880166528523517,
                '주년': 0.026880166528523517, '발표': 0.026880166528523517, '강조': 0.026880166528523517,
                '성장': 0.026880166528523517, '구속': 0.10752066611409407}
        doc3 = {'무료': 0.03925343359894298, '인데요': 0.03925343359894298, '엄격히': 0.03925343359894298,
                '또한': 0.03925343359894298, '판단': 0.03925343359894298, '들어간': 0.11776030079682893,
                '균형': 0.03925343359894298, '기소': 0.03925343359894298, '저작권자': 0.03925343359894298,
                '처음': 0.03925343359894298, '무죄': 0.27477403519260085, '나눠': 0.11776030079682893,
                '문제': 0.11776030079682893, '하지만': 0.03925343359894298, '기자': 0.07850686719788597,
                '위해': 0.11776030079682893, '머니': 0.07850686719788597, '대법원': 0.03925343359894298,
                '토지': 0.03925343359894298, '수단': 0.07850686719788597, '법리': 0.03925343359894298,
                '건조물': 0.07850686719788597, '만화': 0.03925343359894298, '노조': 0.15701373439577193,
                '관리': 0.03925343359894298, '이어': 0.03925343359894298, '조각': 0.07850686719788597,
                '레이싱': 0.03925343359894298, '홍보': 0.03925343359894298, '여기': 0.03925343359894298,
                '혐의': 0.03925343359894298, '사건': 0.11776030079682893, '역시': 0.03925343359894298,
                '정류장': 0.03925343359894298, '침입': 0.23552060159365787, '주거': 0.23552060159365787,
                '사용': 0.03925343359894298, '정당행위': 0.03925343359894298, '유인물': 0.15701373439577193,
                '바꾸': 0.03925343359894298, '본다면': 0.03925343359894298, '시설': 0.03925343359894298,
                '선고': 0.07850686719788597, '들어갔': 0.07850686719788597, '너무': 0.03925343359894298,
                '주변': 0.03925343359894298, '송민경': 0.07850686719788597, '평가': 0.03925343359894298,
                '해당': 0.19626716799471491, '마찬가지': 0.07850686719788597, '봐서': 0.03925343359894298,
                '관련': 0.07850686719788597, '보호': 0.03925343359894298, '상당': 0.03925343359894298,
                '됩니다': 0.03925343359894298, '인정': 0.03925343359894298, '과정': 0.03925343359894298,
                '받아들였': 0.03925343359894298, '선물': 0.03925343359894298, '허락': 0.03925343359894298,
                '겁니다': 0.03925343359894298, '무단': 0.03925343359894298, '의미': 0.07850686719788597,
                '라고': 0.03925343359894298, '이렇게': 0.03925343359894298, '뉴스': 0.03925343359894298,
                '활동': 0.23552060159365787, '아니': 0.03925343359894298, '갖춘': 0.03925343359894298,
                '위한': 0.03925343359894298, '장소': 0.03925343359894298, '본질': 0.03925343359894298,
                '파괴': 0.03925343359894298, '간부': 0.03925343359894298, '타인': 0.03925343359894298,
                '사실': 0.03925343359894298, '판결문': 0.03925343359894298, '결과': 0.03925343359894298,
                '회사': 0.23552060159365787, '따지': 0.03925343359894298, '따라': 0.07850686719788597,
                '인접': 0.03925343359894298, '목적': 0.03925343359894298, '직원': 0.03925343359894298,
                '포함': 0.03925343359894298, '이동': 0.07850686719788597, '노동조합': 0.11776030079682893,
                '요구': 0.03925343359894298, '이익': 0.07850686719788597, '폭력': 0.03925343359894298,
                '퇴거': 0.03925343359894298, '판례': 0.03925343359894298, '출퇴근': 0.03925343359894298,
                '전재': 0.03925343359894298, '투데이': 0.07850686719788597, '판결': 0.15701373439577193,
                '보충': 0.03925343359894298, '동기': 0.03925343359894298, '다른': 0.03925343359894298,
                '위법': 0.07850686719788597, '대해': 0.07850686719788597, '건물': 0.07850686719788597,
                '리얼타임': 0.03925343359894298, '변호사': 0.07850686719788597, '보이': 0.03925343359894298,
                '정당': 0.15701373439577193, '긴급': 0.03925343359894298, '부분': 0.03925343359894298,
                '법원': 0.15701373439577193, '치어리더': 0.03925343359894298, '요건': 0.03925343359894298,
                '셔틀버스': 0.07850686719788597, '기숙사': 0.19626716799471491, '배포': 0.07850686719788597,
                '현관': 0.11776030079682893, '대해서': 0.03925343359894298, '방법': 0.11776030079682893,
                '응하': 0.03925343359894298, '침해': 0.07850686719788597, '행위': 0.3532809023904868,
                '금지': 0.03925343359894298, '법익': 0.03925343359894298, '가까웠': 0.03925343359894298,
                '숙소': 0.03925343359894298, '기사': 0.03925343359894298, '그러나': 0.03925343359894298,
                '라며': 0.03925343359894298, '자체': 0.03925343359894298}
        doc4 = {'참석': 0.03224129401095805, '공사': 0.03224129401095805, '절차': 0.0644825880219161,
                '불린': 0.03224129401095805, '보내왔': 0.03224129401095805, '함께': 0.03224129401095805,
                '황봉': 0.03224129401095805, '결정': 0.35465423412053854, '구성': 0.03224129401095805,
                '정해야': 0.03224129401095805, '기존': 0.03224129401095805, '정보': 0.03224129401095805,
                '못하': 0.03224129401095805, '결과': 0.03224129401095805, '하동': 0.1289651760438322,
                '공간': 0.03224129401095805, '부산': 0.03224129401095805, '선정': 0.03224129401095805,
                '한다': 0.03224129401095805, '공동대책위원회': 0.03224129401095805, '명칭': 0.29017164609862245,
                '입장': 0.0644825880219161, '노량해협': 0.03224129401095805, '아래': 0.03224129401095805,
                '승전': 0.03224129401095805, '채팅': 0.03224129401095805, '위원회': 0.22568905807670636,
                '연륙교': 0.0644825880219161, '이름': 0.03224129401095805, '교량': 0.2579303520876644,
                '지자체': 0.03224129401095805, '공문': 0.03224129401095805, '관철': 0.03224129401095805,
                '유감': 0.03224129401095805, '정해졌': 0.03224129401095805, '행정': 0.03224129401095805,
                '붙여야': 0.03224129401095805, '노량대교': 0.29017164609862245, '요청': 0.03224129401095805,
                '결론': 0.03224129401095805, '관계자': 0.09672388203287414, '환영': 0.0644825880219161,
                '경남': 0.1289651760438322, '설계': 0.03224129401095805, '최고': 0.03224129401095805,
                '상당': 0.03224129401095805, '표시': 0.03224129401095805, '이유': 0.03224129401095805,
                '이번': 0.0644825880219161, '최신': 0.03224129401095805, '지역': 0.03224129401095805,
                '관리': 0.0644825880219161, '연합뉴스': 0.0644825880219161, '도도': 0.03224129401095805,
                '어렵': 0.03224129401095805, '사안': 0.03224129401095805, '준공': 0.03224129401095805,
                '연결': 0.03224129401095805, '확장': 0.03224129401095805, '법률': 0.03224129401095805,
                '표결': 0.03224129401095805, '맞서': 0.03224129401095805, '완공': 0.03224129401095805,
                '생명': 0.03224129401095805, '지명': 0.3224129401095805, '아쉽': 0.03224129401095805,
                '건설': 0.03224129401095805, '한다고': 0.03224129401095805, '군수': 0.03224129401095805,
                '가결': 0.03224129401095805, '국도': 0.03224129401095805, '트렌드': 0.03224129401095805,
                '의미': 0.03224129401095805, '의결': 0.03224129401095805, '구축': 0.03224129401095805,
                '물동량': 0.03224129401095805, '대해': 0.03224129401095805, '기사': 0.03224129401095805,
                '반면': 0.03224129401095805, '설천면': 0.03224129401095805, '갈등': 0.09672388203287414,
                '줄곧': 0.03224129401095805, '이날': 0.0644825880219161, '회의': 0.0644825880219161,
                '문제': 0.03224129401095805, '지난해': 0.03224129401095805, '제보': 0.03224129401095805,
                '준비': 0.03224129401095805, '자료': 0.03224129401095805, '이순신': 0.03224129401095805,
                '하자': 0.03224129401095805, '주장': 0.16120647005479025, '잘못': 0.03224129401095805,
                '수용': 0.09672388203287414, '군민': 0.09672388203287414, '국가': 0.09672388203287414,
                '정할': 0.03224129401095805, '들어갔': 0.03224129401095805, '따라야': 0.03224129401095805,
                '기관': 0.03224129401095805, '기자': 0.0644825880219161, '따라': 0.03224129401095805,
                '따르': 0.03224129401095805, '국토': 0.16120647005479025, '원하': 0.03224129401095805,
                '대로': 0.03224129401095805, '즉각': 0.03224129401095805, '나와': 0.03224129401095805,
                '관한': 0.03224129401095805, '위한': 0.03224129401095805, '설치': 0.03224129401095805,
                '밝혔': 0.0644825880219161, '사진': 0.03224129401095805, '별다른': 0.03224129401095805,
                '공식': 0.03224129401095805, '고시': 0.03224129401095805, '하동군': 0.22568905807670636,
                '흐르': 0.03224129401095805, '남해': 0.03224129401095805, '금남면': 0.03224129401095805,
                '관련': 0.03224129401095805, '남해대교': 0.1934477640657483, '서로': 0.03224129401095805,
                '그러': 0.1289651760438322, '장군': 0.03224129401095805, '심의': 0.09672388203287414,
                '브리핑': 0.03224129401095805, '한다는': 0.0644825880219161, '반발': 0.0644825880219161,
                '문의': 0.03224129401095805, '유행': 0.03224129401095805, '전했': 0.03224129401095805,
                '남해군': 0.2579303520876644, '만큼': 0.03224129401095805, '당시': 0.03224129401095805,
                '보여': 0.03224129401095805, '지방': 0.03224129401095805, '사이': 0.03224129401095805,
                '차례': 0.03224129401095805, '상황': 0.03224129401095805, '소송': 0.03224129401095805,
                '기준': 0.03224129401095805, '위원': 0.03224129401095805, '당위': 0.03224129401095805,
                '해협': 0.03224129401095805, '창원': 0.03224129401095805}
        doc5 = {'조건': 0.024182541670333724, '반격': 0.024182541670333724, '대표단': 0.04836508334066745,
                '통해': 0.024182541670333724, '인정': 0.04836508334066745, '이동해': 0.024182541670333724,
                '미사일': 0.024182541670333724, '모처럼': 0.024182541670333724, '분석': 0.024182541670333724,
                '전용기': 0.024182541670333724, '기지': 0.04836508334066745, '의중': 0.024182541670333724,
                '마련': 0.024182541670333724, '천안': 0.07254762501100116, '온도': 0.024182541670333724,
                '자체': 0.024182541670333724, '라고': 0.024182541670333724, '요구': 0.024182541670333724,
                '카카오': 0.024182541670333724, '유지혜': 0.024182541670333724, '소식통': 0.024182541670333724,
                '미국': 0.16927779169233606, '직후': 0.024182541670333724, '인권': 0.0967301666813349,
                '강경': 0.024182541670333724, '그런': 0.024182541670333724, '오전': 0.04836508334066745,
                '강제': 0.024182541670333724, '서해': 0.07254762501100116, '만났': 0.024182541670333724,
                '금지': 0.024182541670333724, '발생': 0.024182541670333724, '어뢰': 0.024182541670333724,
                '개회식': 0.07254762501100116, '부인': 0.024182541670333724, '공군': 0.024182541670333724,
                '헬기': 0.024182541670333724, '우선': 0.024182541670333724, '눈시울': 0.024182541670333724,
                '펜스': 0.3385555833846721, '오후': 0.04836508334066745, '전시': 0.024182541670333724,
                '이동': 0.04836508334066745, '국가': 0.04836508334066745, '도착': 0.024182541670333724,
                '한쪽': 0.04836508334066745, '아시아': 0.024182541670333724, '다리': 0.024182541670333724,
                '동석': 0.024182541670333724, '공개': 0.024182541670333724, '연합뉴스': 0.024182541670333724,
                '만들': 0.024182541670333724, '중앙': 0.024182541670333724, '호관': 0.04836508334066745,
                '오늘': 0.024182541670333724, '연평도': 0.024182541670333724, '수십만': 0.024182541670333724,
                '함대': 0.07254762501100116, '매력': 0.07254762501100116, '대해서': 0.04836508334066745,
                '연결': 0.024182541670333724, '오산': 0.04836508334066745, '유린': 0.024182541670333724,
                '함께': 0.024182541670333724, '참가': 0.024182541670333724, '부장': 0.024182541670333724,
                '생각': 0.024182541670333724, '정부': 0.024182541670333724, '김여정': 0.024182541670333724,
                '발표': 0.024182541670333724, '여러분': 0.024182541670333724, '분위기': 0.04836508334066745,
                '진실': 0.04836508334066745, '대통령': 0.14509525002200233, '수용소': 0.024182541670333724,
                '끌어안': 0.024182541670333724, '숨진': 0.024182541670333724, '나눴': 0.024182541670333724,
                '제재': 0.04836508334066745, '마이크': 0.0967301666813349, '앞서': 0.024182541670333724,
                '한다는': 0.04836508334066745, '대해': 0.024182541670333724, '소통': 0.024182541670333724,
                '설명': 0.024182541670333724, '틸러': 0.024182541670333724, '평택': 0.07254762501100116,
                '실제': 0.024182541670333724, '맞춰야': 0.024182541670333724, '지나': 0.024182541670333724,
                '중앙일보': 0.04836508334066745, '어떤': 0.024182541670333724, '지속': 0.024182541670333724,
                '들춰내': 0.024182541670333724, '관여': 0.024182541670333724, '새로운': 0.024182541670333724,
                '외교부': 0.024182541670333724, '희생': 0.04836508334066745, '전력': 0.024182541670333724,
                '적셨': 0.024182541670333724, '기관': 0.024182541670333724, '목격': 0.024182541670333724,
                '알려': 0.04836508334066745, '방문': 0.07254762501100116, '태도': 0.024182541670333724,
                '폭침': 0.024182541670333724, '아픔': 0.024182541670333724, '고도': 0.024182541670333724,
                '위한': 0.04836508334066745, '존재': 0.024182541670333724, '동취': 0.04836508334066745,
                '밝혔': 0.024182541670333724, '비핵화': 0.07254762501100116, '매일': 0.024182541670333724,
                '경기': 0.024182541670333724, '취한': 0.024182541670333724, '무단': 0.024182541670333724,
                '전화': 0.024182541670333724, '교서': 0.024182541670333724, '대북': 0.04836508334066745,
                '발언': 0.024182541670333724, '평창동': 0.024182541670333724, '만난': 0.04836508334066745,
                '경기도': 0.024182541670333724, '작가': 0.024182541670333724, '이끌': 0.04836508334066745,
                '대학생': 0.024182541670333724, '살펴봤': 0.024182541670333724, '대화': 0.07254762501100116,
                '전했': 0.04836508334066745, '책임': 0.024182541670333724, '비로소': 0.024182541670333724,
                '부근': 0.024182541670333724, '그은': 0.024182541670333724, '실체': 0.04836508334066745,
                '지성호': 0.07254762501100116, '외교': 0.024182541670333724, '열병식': 0.024182541670333724,
                '상황': 0.04836508334066745, '여러': 0.024182541670333724, '완화': 0.024182541670333724,
                '취해야': 0.024182541670333724, '외신': 0.024182541670333724, '기리': 0.024182541670333724,
                '문재': 0.024182541670333724, '그렇게': 0.024182541670333724, '참석': 0.0967301666813349,
                '시작': 0.024182541670333724, '약점': 0.024182541670333724, '사령부': 0.07254762501100116,
                '미공군': 0.024182541670333724, '둘러보': 0.024182541670333724, '친구': 0.024182541670333724,
                '체제': 0.04836508334066745, '재단': 0.04836508334066745, '자국': 0.024182541670333724,
                '전재': 0.024182541670333724, '위해': 0.024182541670333724, '북방': 0.024182541670333724,
                '가능': 0.024182541670333724, '기존': 0.024182541670333724, '뉴시스': 0.024182541670333724,
                '나오': 0.024182541670333724, '억류': 0.024182541670333724, '다음': 0.024182541670333724,
                '치명': 0.024182541670333724, '아버지': 0.024182541670333724, '계기': 0.024182541670333724,
                '기준선': 0.024182541670333724, '한다': 0.024182541670333724, '정권': 0.07254762501100116,
                '프레드': 0.04836508334066745, '평소': 0.024182541670333724, '배포': 0.024182541670333724,
                '총공세': 0.024182541670333724, '해군': 0.04836508334066745, '평화': 0.024182541670333724,
                '시설': 0.024182541670333724, '플러스': 0.024182541670333724, '테이블': 0.024182541670333724,
                '폐기': 0.024182541670333724, '모바일': 0.04836508334066745, '현서': 0.024182541670333724,
                '초청': 0.024182541670333724, '전날': 0.04836508334066745, '유엔': 0.024182541670333724,
                '독재': 0.024182541670333724, '기록': 0.024182541670333724, '여사': 0.024182541670333724,
                '일부': 0.024182541670333724, '고문': 0.024182541670333724, '조치': 0.07254762501100116,
                '부통령': 0.3143730417143384, '위원회': 0.024182541670333724, '노동당': 0.024182541670333724,
                '캐런': 0.024182541670333724, '올림픽': 0.0967301666813349, '동강': 0.024182541670333724,
                '주한': 0.024182541670333724, '올려': 0.024182541670333724, '노동': 0.024182541670333724,
                '보도': 0.04836508334066745, '한계선': 0.024182541670333724, '고려': 0.024182541670333724,
                '도널드': 0.024182541670333724, '다소': 0.024182541670333724, '회의장': 0.024182541670333724,
                '갇혀': 0.024182541670333724, '만나': 0.04836508334066745, '탈북자': 0.04836508334066745,
                '노리': 0.024182541670333724, '오른쪽': 0.024182541670333724, '증언': 0.04836508334066745,
                '조직': 0.024182541670333724, '장관': 0.024182541670333724, '참모': 0.024182541670333724,
                '국제': 0.024182541670333724, '대한': 0.024182541670333724, '이날': 0.0967301666813349,
                '트럼프': 0.0967301666813349, '반영': 0.024182541670333724, '렉스': 0.024182541670333724,
                '의미': 0.024182541670333724, '감금': 0.024182541670333724, '이틀': 0.024182541670333724,
                '포격': 0.024182541670333724, '미국인': 0.024182541670333724, '자리': 0.024182541670333724,
                '공격': 0.024182541670333724, '한국': 0.04836508334066745, '문제': 0.04836508334066745,
                '감옥': 0.024182541670333724, '차례': 0.024182541670333724, '접근': 0.04836508334066745,
                '행보': 0.024182541670333724, '감추': 0.024182541670333724, '협상': 0.04836508334066745,
                '비어': 0.024182541670333724, '조사': 0.024182541670333724, '균형': 0.024182541670333724,
                '보고서': 0.024182541670333724, '겨울': 0.024182541670333724, '지난달': 0.024182541670333724,
                '우려': 0.024182541670333724, '기자': 0.04836508334066745, '이뤄지는': 0.024182541670333724,
                '드러내': 0.024182541670333724, '목적': 0.024182541670333724, '사회': 0.024182541670333724,
                '그간': 0.024182541670333724, '안보': 0.024182541670333724, '연두': 0.024182541670333724,
                '표했': 0.024182541670333724, '백악관': 0.024182541670333724, '입장': 0.04836508334066745,
                '장병': 0.04836508334066745, '집무실': 0.024182541670333724, '사진': 0.024182541670333724,
                '지금': 0.07254762501100116, '추정': 0.024182541670333724, '보장': 0.024182541670333724,
                '이뤄지고': 0.024182541670333724, '국무': 0.024182541670333724, '방한': 0.0967301666813349,
                '변화': 0.024182541670333724, '세계': 0.04836508334066745, '하원': 0.024182541670333724,
                '구체': 0.04836508334066745, '평창': 0.12091270835166862, '접견': 0.024182541670333724,
                '오토': 0.024182541670333724, '연평해전': 0.024182541670333724, '순방': 0.024182541670333724,
                '평택시': 0.024182541670333724, '김정은': 0.024182541670333724, '돌아온': 0.024182541670333724,
                '규정': 0.04836508334066745, '국민': 0.024182541670333724, '도발': 0.07254762501100116,
                '가운데': 0.04836508334066745, '공세': 0.04836508334066745, '페이스북': 0.024182541670333724,
                '반박': 0.024182541670333724, '통신': 0.04836508334066745, '굶주리': 0.024182541670333724,
                '면담': 0.024182541670333724, '중요': 0.024182541670333724, '회유': 0.024182541670333724,
                '북한': 0.5803810000880093, '실외': 0.024182541670333724, '걱정': 0.024182541670333724,
                '출발': 0.024182541670333724, '내려': 0.024182541670333724}
        temp = {1:doc1, 2:doc2, 3:doc3, 4:doc4, 5:doc5}
        return temp[document_id]


    def add_new_document(self, doucment_id_list):
        '''
        document_id들을 인자로 받아서 해당 document_id의 tf_vector들을 파일에 추가하고, jaccard_similarity_matrix를 업데이트한다.
        :param doucment_id_list: document_id를 원소로 갖는 리스트 (list) 
        :return: None
        '''
        for document_id in doucment_id_list:
            if document_id not in self.dtm_index:
                tf_dic = self.get_document_tfvector(document_id)
                tf_list = [(k, v) for k, v in tf_dic.items() if v > 0.1]  # tfidf 값이 0.1 이상인 정보만 남긴다.
                tf_list = sorted(tf_list, key=lambda word: word[1], reverse=True)  # 내림차순으로 정렬
                tf_list = [x[0] for x in tf_list][:10]  # 상위 10개
                tf_string = " ".join(tf_list)

                self.dtm_index.append(document_id)
                self.dtm_list.append(tf_string)
            else:
                print("The document_id", document_id, "is already included in dtm_list.")

        self.save_updated_document_list()
        self.create_jaccard_matrix()


    def save_updated_document_list(self):
        '''
        변경된 사항을 pickle을 이용해 저장한다.
        :return: None
        '''
        with open(self.path, mode="wb") as fp:
            pickle.dump([self.dtm_index, self.dtm_list], fp)


    def create_dtm(self):
        '''
        sklearn의 CountVectorizer을 이용해 주어진 리스트를 sparse_matrix 형태로 만든다.
        :return: None
        '''
        self.dtm = self.vctr.fit_transform(self.dtm_list).toarray()


    def create_jaccard_matrix(self):
        '''
        모든 document와 document의 유사도 정보를 갖는 jaccard_similar_matrix로 만든다. 
        :return: None
        '''
        self.create_dtm()
        self.jaccard_matrix = (1 - pairwise_distances(self.dtm, metric="hamming"))


    def get_similar_document(self, document_id, n):
        '''
        target document_id와 n을 입력 받아, n개의 유사한 document의 id를 반환한다.
        :param document_id: 유사한 대상을 찾고자 하는 타겟 document_id (string) 
        :param n: 찾고자 하는 유사한 document의 개수 (integer)
        :return: document_id를 원소로 갖는 리스트 (list)
        '''
        try:
            target_number = self.dtm_index.index(document_id)
        except:
            print("The document_id does not exist in Document_Term_Matrix.")

        top_n_index = np.argsort(self.jaccard_matrix[target_number])[-2:-(2 + n):-1]
        top_n_document = np.array(self.dtm_index)[np.array(top_n_index)]
        return list(top_n_document)


    def search_news_document(self, search_query, n):
        '''
        검색어와 jaccard_similarity가 가장 가까운 document의 id를 원소로 갖는 리스트를 반환한다.
        :param search_query: 찾고자 하는 검색어 (string)
        :param n: 유사한 document의 수 (integer) #보통 n=5 정도로 하자. 
        :return: 검색어와 가장 유사한 document_id를 원소로 갖는 리스트 (list)
        '''

        #search_query를 기존 dtm에 맞는 vector 형태로 변환
        target_vector = self.vctr.transform([search_query]).toarray()

        #기존 dtm_index와 dtm_list에 영향을 주지 않기 위해 copy하고 copy된 객체 위에서 jaccard 거리 산출
        search_dtm_index = (self.dtm_index.copy())
        search_dtm_index.append("target_index")
        search_dtm = np.append((self.dtm.copy()), target_vector, axis=0)
        search_jaccard_matrix = (1 - pairwise_distances(search_dtm, metric="hamming"))

        #임시로 산출된 jaccard_matrix에서 검색어(search_query)와 가장 유사한 document의 id를 반환
        search_target = search_dtm_index.index("target_index")
        top_n_index = np.argsort(search_jaccard_matrix[search_target])[-2:-(2 + n):-1]
        top_n_document = np.array(self.dtm_index)[np.array(top_n_index)]
        return list(top_n_document)
